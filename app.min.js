document.addEventListener("DOMContentLoaded",(()=>{fetchTasks()}));async function fetchTasks(){try{const response=await fetch("http://localhost:3001/api/tasks");if(!response.ok){throw new Error(`Network error: ${response.status} ${response.statusText}`)}const tasks=await response.json();displayTasks(tasks)}catch(err){console.error("Failed to fetch tasks:",err);alert("Failed to load tasks. Please try again later.")}}function displayTasks(tasks){const taskList=document.getElementById("taskList");taskList.innerHTML="";tasks.forEach((task=>{const taskItem=document.createElement("li");taskItem.textContent=`${task.name} - ${task.difficulty.toUpperCase()} ${task.completed?"(Completed)":""}`;if(!task.completed){const completeButton=document.createElement("button");completeButton.textContent="Complete";completeButton.onclick=()=>completeTask(task._id);taskItem.appendChild(completeButton)}taskList.appendChild(taskItem)}))}async function completeTask(taskId){try{const response=await fetch(`http://localhost:3001/api/tasks/${taskId}/complete`,{method:"PATCH"});if(!response.ok)throw new Error("Task completion failed");const result=await response.json();fetchTasks();const eloElement=document.getElementById("eloScore");if(eloElement){const currentElo=parseInt(eloElement.textContent)||1200;eloElement.textContent=currentElo+result.eloChange;eloElement.style.color="green";setTimeout((()=>eloElement.style.color=""),1e3)}}catch(err){console.error("Completion failed:",err)}}async function addTask(){const taskName=document.getElementById("taskInput").value;const difficulty=document.getElementById("difficultySelect").value;const eloImpact={easy:5,medium:10,hard:20}[difficulty];if(!taskName.trim()){alert("Task name is required.");return}try{const response=await fetch("http://localhost:3001/api/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:taskName,difficulty:difficulty,eloImpact:eloImpact})});if(!response.ok)throw new Error("Failed to add task");document.getElementById("taskInput").value="";fetchTasks()}catch(err){console.error("Task creation failed:",err)}}